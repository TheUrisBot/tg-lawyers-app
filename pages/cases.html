<section class="page cases" id="cases-page" aria-labelledby="cases-title">
  <h1 id="cases-title">–î–µ–ª–∞</h1>

  <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
  <div class="cases-toolbar" role="region" aria-label="–ü–æ–∏—Å–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è">
    <div class="cases-search">
      <input id="cases-search-input" type="search" placeholder="–ù–æ–º–µ—Ä –¥–µ–ª–∞, –¥–æ–ª–∂–Ω–∏–∫, —Å—É–¥, –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ"
             aria-label="–ü–æ–∏—Å–∫ –ø–æ –¥–µ–ª–∞–º" oninput="CASES && CASES.setQuery(this.value)" />
      <button class="ghost" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"
              onclick="CASES && CASES.setQuery(''); const i=document.getElementById('cases-search-input'); i.value=''; i.focus();">‚úï</button>
    </div>
    <button class="primary" id="cases-add-btn" aria-expanded="false" onclick="CASES && CASES.toggleForm()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="cases-filters" role="tablist" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É">
    <button class="chip active" role="tab" aria-selected="true" onclick="CASES && CASES.setFilter('all', this)">–í—Å–µ</button>
    <button class="chip" role="tab" aria-selected="false" onclick="CASES && CASES.setFilter('active', this)">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
    <button class="chip" role="tab" aria-selected="false" onclick="CASES && CASES.setFilter('archived', this)">–ê—Ä—Ö–∏–≤</button>
  </div>

  <!-- –§–æ—Ä–º–∞ -->
  <div id="cases-form-wrap" class="collapse" aria-hidden="true">
    <form id="cases-form" class="cases-form" onsubmit="CASES && CASES.submit(event)">
      <div class="grid">
        <label>
          <span>–ù–æ–º–µ—Ä –¥–µ–ª–∞ *</span>
          <input type="text" id="c-number" required placeholder="–ê40-12345/2025" />
        </label>
        <label>
          <span>–î–æ–ª–∂–Ω–∏–∫</span>
          <input type="text" id="c-debtor" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò. / –û–û–û ¬´–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞¬ª" />
        </label>
        <label>
          <span>–ò–ù–ù</span>
          <input type="text" id="c-inn" inputmode="numeric" pattern="[0-9]{10,12}" placeholder="10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
        </label>
        <label>
          <span>–°—É–¥</span>
          <input type="text" id="c-court" placeholder="–ê–° –≥. –ú–æ—Å–∫–≤—ã" />
        </label>
        <label style="grid-column: 1 / -1;">
          <span>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span>
          <textarea id="c-note" rows="2" placeholder="–õ—é–±—ã–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –¥–µ–ª—É"></textarea>
        </label>
        <label>
          <span>–°—Ç–∞—Ç—É—Å</span>
          <select id="c-status">
            <option value="active" selected>–ê–∫—Ç–∏–≤–Ω–æ–µ</option>
            <option value="archived">–ê—Ä—Ö–∏–≤</option>
          </select>
        </label>
      </div>
      <div class="form-actions">
        <button type="button" class="ghost" onclick="CASES && CASES.toggleForm(false)">–°–≤–µ—Ä–Ω—É—Ç—å</button>
        <button type="submit" id="cases-submit-btn" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ -->
  <div id="cases-list" class="cases-list" role="list" aria-label="–°–ø–∏—Å–æ–∫ –¥–µ–ª"></div>

  <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
  <div id="cases-empty" class="cases-empty">
    <div class="emoji">üìÇ</div>
    <div class="title">–ü–æ–∫–∞ –Ω–µ—Ç –¥–µ–ª</div>
    <div class="hint">–î–æ–±–∞–≤—å –ø–µ—Ä–≤–æ–µ –¥–µ–ª–æ ‚Äî –Ω–æ–º–µ—Ä, –¥–æ–ª–∂–Ω–∏–∫ (–ø–æ –∂–µ–ª–∞–Ω–∏—é), —Å—É–¥‚Ä¶</div>
    <button class="primary" onclick="CASES && CASES.toggleForm(true)">–î–æ–±–∞–≤–∏—Ç—å –¥–µ–ª–æ</button>
    <div class="list-spacer"></div>
  </div>

  <style>
    .cases-toolbar { display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .cases-search { display:grid; grid-template-columns:1fr auto; gap:6px; }
    .cases-search input{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--separator);
      background:var(--tg-theme-secondary-bg-color); color:var(--tg-theme-text-color); outline:none; }
    .cases-search input:focus{ border-color:var(--app-accent); }
    .cases-filters{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
    .chip{ border:1px solid var(--separator); background:transparent; color:var(--tg-theme-text-color);
      padding:6px 10px; border-radius:999px; cursor:pointer; }
    .chip.active{ border-color:var(--app-accent); color:var(--app-accent); font-weight:600; }

    .collapse{ max-height:0; overflow:hidden; opacity:0; transition:max-height 240ms ease, opacity 240ms ease; }
    .collapse.open{ opacity:1; }

    .cases-form{ border:1px solid var(--separator); background:var(--tg-theme-secondary-bg-color);
      border-radius:16px; padding:12px; display:grid; gap:12px; margin-top:8px; }
    .cases-form .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .cases-form label{ display:grid; gap:6px; font-size:12px; color:var(--tg-theme-hint-color); }
    .cases-form input,.cases-form select,.cases-form textarea{
      padding:10px 12px; border-radius:12px; border:1px solid var(--separator);
      background:var(--tg-theme-bg-color); color:var(--tg-theme-text-color); outline:none; resize:vertical;
    }
    .cases-form input:focus,.cases-form select:focus,.cases-form textarea:focus{ border-color:var(--app-accent); }
    .form-actions{ display:flex; gap:8px; justify-content:flex-end; }

    /* ‚¨áÔ∏è –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ ‚Äî –∫–∞–∫ –≤ hearings.html */
    .primary,.ghost{ appearance:none; border:1px solid transparent; padding:10px 12px; border-radius:12px; cursor:pointer;
      background:var(--tg-theme-button-color); color:var(--tg-theme-button-text-color); }
    .ghost{ background:transparent; border-color:var(--separator); color:var(--tg-theme-text-color); }

    .cases-list{ display:grid; gap:8px; margin-top:8px; }
    .case-card{ border:1px solid var(--separator); background:var(--tg-theme-secondary-bg-color);
      border-radius:16px; padding:12px; display:grid; gap:6px; }
    .case-head{ display:flex; justify-content:space-between; align-items:baseline; gap:8px; }
    .case-number{ font-weight:700; }
    .badge{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--separator); color:var(--tg-theme-hint-color); }
    .badge.active{ color:var(--app-accent); border-color:var(--app-accent); }
    .case-row{ display:flex; gap:10px; flex-wrap:wrap; color:var(--tg-theme-hint-color); font-size:14px; }
    .case-actions{ display:flex; gap:8px; margin-top:6px; }
    .case-actions .ghost{ border:1px solid var(--separator); background:transparent; border-radius:12px; padding:8px 10px; }

    .cases-empty{ text-align:center; padding:20px 8px; color:var(--tg-theme-hint-color); display:none; }
    .cases-empty .emoji{ font-size:36px; margin-bottom:8px; }
    .cases-empty .title{ font-weight:700; color:var(--tg-theme-text-color); }
    .list-spacer{ height:16px; }

    @media (max-width: 520px){ .cases-form .grid{ grid-template-columns:1fr; } }
  </style>

  <script type="text/plain" id="cases-inline-js">
  (function(){
    /* –°–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—É–¥–æ–≤ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É */
    const PREFIX_TO_COURT = {
      '–ê01-': '–ê–° –†–µ—Å–ø. –ê–¥—ã–≥–µ—è',
      '–ê02-': '–ê–° –†–µ—Å–ø. –ê–ª—Ç–∞–π',
      '–ê03-': '–ê–° –ê–ª—Ç–∞–π—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê04-': '–ê–° –ê–º—É—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê05-': '–ê–° –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–æ–π –æ–±–ª.',
      '–ê06-': '–ê–° –ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê07-': '–ê–° –†–µ—Å–ø. –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω',
      '–ê08-': '–ê–° –ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê09-': '–ê–° –ë—Ä—è–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê10-': '–ê–° –†–µ—Å–ø. –ë—É—Ä—è—Ç–∏—è',
      '–ê11-': '–ê–° –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê12-': '–ê–° –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê13-': '–ê–° –í–æ–ª–æ–≥–æ–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê14-': '–ê–° –í–æ—Ä–æ–Ω–µ–∂—Å–∫–æ–π –æ–±–ª.',
      '–ê15-': '–ê–° –ï–≤—Ä–µ–π—Å–∫–æ–π –ê–û',
      '–ê16-': '–ê–° –ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê17-': '–ê–° –ò–≤–∞–Ω–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê18-': '–ê–° –ò—Ä–∫—É—Ç—Å–∫–æ–π –æ–±–ª.',
      '–ê19-': '–ê–° –ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä—Å–∫–æ–π –†–µ—Å–ø.',
      '–ê20-': '–ê–° –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê21-': '–ê–° –ö–∞–ª—É–∂—Å–∫–æ–π –æ–±–ª.',
      '–ê22-': '–ê–° –ö–∞–º—á–∞—Ç—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê23-': '–ê–° –ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å—Å–∫–æ–π –†–µ—Å–ø.',
      '–ê24-': '–ê–° –†–µ—Å–ø. –ö–∞—Ä–µ–ª–∏—è',
      '–ê25-': '–ê–° –ö–µ–º–µ—Ä–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê26-': '–ê–° –ö–∏—Ä–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê27-': '–ê–° –†–µ—Å–ø. –ö–æ–º–∏',
      '–ê28-': '–ê–° –ö–æ—Å—Ç—Ä–æ–º—Å–∫–æ–π –æ–±–ª.',
      '–ê29-': '–ê–° –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–æ–π –æ–±–ª.',
      '–ê31-': '–ê–° –ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê32-': '–ê–° –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê33-': '–ê–° –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê34-': '–ê–° –ö—É—Ä–≥–∞–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê35-': '–ê–° –ö—É—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê36-': '–ê–° –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª.',
      '–ê37-': '–ê–° –ú–∞–≥–∞–¥–∞–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê38-': '–ê–° –†–µ—Å–ø. –ú–∞—Ä–∏–π –≠–ª',
      '–ê39-': '–ê–° –†–µ—Å–ø. –ú–æ—Ä–¥–æ–≤–∏—è',
      '–ê40-': '–ê–° –≥. –ú–æ—Å–∫–≤—ã',
      '–ê41-': '–ê–° –ú–æ—Å–∫. –æ–±–ª.',
      '–ê42-': '–ê–° –ú—É—Ä–º–∞–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê43-': '–ê–° –ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê44-': '–ê–° –ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–±–ª.',
      '–ê45-': '–ê–° –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê46-': '–ê–° –û–º—Å–∫–æ–π –æ–±–ª.',
      '–ê47-': '–ê–° –û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–æ–π –æ–±–ª.',
      '–ê48-': '–ê–° –û—Ä–ª–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê49-': '–ê–° –ü–µ–Ω–∑–µ–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê50-': '–ê–° –ü–µ—Ä–º—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê51-': '–ê–° –ü—Ä–∏–º–æ—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê52-': '–ê–° –ü—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê53-': '–ê–° –†–æ—Å—Ç–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê54-': '–ê–° –†—è–∑–∞–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê55-': '–ê–° –°–∞–º–∞—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê56-': '–ê–° –≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ –∏ –õ–µ–Ω. –æ–±–ª.',
      '–ê57-': '–ê–° –°–∞—Ä–∞—Ç–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê58-': '–ê–° –†–µ—Å–ø. –°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)',
      '–ê59-': '–ê–° –°–∞—Ö–∞–ª–∏–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê60-': '–ê–° –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê61-': '–ê–° –°–º–æ–ª–µ–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê62-': '–ê–° –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê63-': '–ê–° –¢–∞–º–±–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê64-': '–ê–° –¢–≤–µ—Ä—Å–∫–æ–π –æ–±–ª.',
      '–ê65-': '–ê–° –¢–æ–º—Å–∫–æ–π –æ–±–ª.',
      '–ê66-': '–ê–° –¢—É–ª—å—Å–∫–æ–π –æ–±–ª.',
      '–ê67-': '–ê–° –¢—é–º–µ–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê68-': '–ê–° –£–ª—å—è–Ω–æ–≤—Å–∫–æ–π –æ–±–ª.',
      '–ê69-': '–ê–° –•–∞–±–∞—Ä–æ–≤—Å–∫–æ–≥–æ –∫—Ä–∞—è',
      '–ê70-': '–ê–° –•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–æ–≥–æ –ê–û',
      '–ê71-': '–ê–° –ß–µ–ª—è–±–∏–Ω—Å–∫–æ–π –æ–±–ª.',
      '–ê72-': '–ê–° –ß–µ—á–µ–Ω—Å–∫–æ–π –†–µ—Å–ø.',
      '–ê73-': '–ê–° –ß—É–≤–∞—à—Å–∫–æ–π –†–µ—Å–ø.',
      '–ê74-': '–ê–° –ß—É–∫–æ—Ç—Å–∫–æ–≥–æ –ê–û',
      '–ê75-': '–ê–° –Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–æ–≥–æ –ê–û',
      '–ê76-': '–ê–° –Ø—Ä–æ—Å–ª–∞–≤—Å–∫–æ–π –æ–±–ª.'
    };

    function normalizeCaseNumber(s){
      return String(s||'')
        .toUpperCase()
        .replace(/[A]/g,'–ê')        // –ª–∞—Ç–∏–Ω—Å–∫–∞—è A -> –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∞—è –ê
        .replace(/[‚Äî‚àí‚Äì]/g,'-')      // –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–∏—Ä–µ -> –¥–µ—Ñ–∏—Å
        .replace(/\s+/g,'');        // —É–±—Ä–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã
    }
    function guessCourtByNumber(num){
      const n = normalizeCaseNumber(num);
      for (const pref in PREFIX_TO_COURT){
        if (Object.prototype.hasOwnProperty.call(PREFIX_TO_COURT, pref) && n.startsWith(pref)){
          return PREFIX_TO_COURT[pref];
        }
      }
      const m = n.match(/^–ê\d{2}-/);
      if (m && PREFIX_TO_COURT[m[0]]) return PREFIX_TO_COURT[m[0]];
      return '';
    }
    function setExpanded(btn, wrap, open){ btn?.setAttribute('aria-expanded', String(open)); wrap?.setAttribute('aria-hidden', String(!open)); }

    window.CASES = {
      LS_KEY: 'tl_cases_v1',
      data: [],
      state: { query:'', filter:'all' },
      editingId: null,

      init(){
        try{ this.data = JSON.parse(localStorage.getItem(this.LS_KEY)||'[]')||[]; }catch(e){ this.data=[]; }

        const wrap=document.getElementById('cases-form-wrap');
        const btn=document.getElementById('cases-add-btn');
        setExpanded(btn, wrap, false);

        // –ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ—á–∏—Å—Ç–∫–∞ ¬´–°—É–¥–∞¬ª –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
        const numEl=document.getElementById('c-number');
        const courtEl=document.getElementById('c-court');
        const onNumberInput=()=>{
          if(!numEl || !courtEl) return;
          const g = guessCourtByNumber(numEl.value);
          if (g) {
            courtEl.value = g;
            courtEl.dataset.autofilled = '1';
          } else if (courtEl.dataset.autofilled === '1') {
            courtEl.value = '';
            delete courtEl.dataset.autofilled;
          }
        };
        numEl?.addEventListener('input', onNumberInput);
        numEl?.addEventListener('change', onNumberInput);
        courtEl?.addEventListener('input', ()=>{ delete courtEl.dataset.autofilled; });

        this.render();
      },

      toggleForm(force){
        const wrap=document.getElementById('cases-form-wrap');
        const btn=document.getElementById('cases-add-btn');
        const isOpen=wrap.classList.contains('open');
        const shouldOpen = (typeof force==='boolean') ? force : !isOpen;
        if (shouldOpen===isOpen) return;

        wrap.style.overflow='hidden';
        if (shouldOpen){
          wrap.classList.add('open');
          wrap.style.maxHeight = wrap.scrollHeight + 'px';
          setExpanded(btn, wrap, true);
          document.getElementById('c-number').focus();
        } else {
          wrap.style.maxHeight = wrap.scrollHeight + 'px';
          requestAnimationFrame(()=>{ wrap.style.maxHeight='0px'; });
          setExpanded(btn, wrap, false);
          wrap.addEventListener('transitionend', ()=>wrap.classList.remove('open'), {once:true});
          this.cancelEdit();
        }
      },

      edit(id){
        const item=this.data.find(x=>x.id===id); if(!item) return;
        this.editingId=id;
        document.getElementById('c-number').value=item.number||'';
        document.getElementById('c-debtor').value=item.debtor||'';
        document.getElementById('c-inn').value=item.inn||'';
        document.getElementById('c-court').value=item.court||'';
        { const el=document.getElementById('c-court'); if(el){ delete el.dataset.autofilled; } }
        document.getElementById('c-note').value=item.note||'';
        document.getElementById('c-status').value=item.status||'active';
        document.getElementById('cases-submit-btn').textContent='–û–±–Ω–æ–≤–∏—Ç—å';
        this.toggleForm(true);
      },

      cancelEdit(){
        this.editingId=null;
        document.getElementById('cases-submit-btn').textContent='–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
        ['c-number','c-debtor','c-inn','c-court','c-note'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
        { const el=document.getElementById('c-court'); if(el){ delete el.dataset.autofilled; } }
        document.getElementById('c-status').value='active';
      },

      submit(ev){
        ev.preventDefault();
        const number=document.getElementById('c-number').value.trim();
        const debtor=document.getElementById('c-debtor').value.trim();
        const inn=document.getElementById('c-inn').value.trim();
        let court=document.getElementById('c-court').value.trim();
        if(!court){ court = guessCourtByNumber(number) || ''; }
        const note=document.getElementById('c-note').value.trim();
        const status=document.getElementById('c-status').value;

        if(!number){ alert('–£–∫–∞–∂–∏ –Ω–æ–º–µ—Ä –¥–µ–ª–∞'); return; }

        const now=Date.now();
        if(this.editingId){
          const i=this.data.findIndex(x=>x.id===this.editingId);
          if(i!==-1) this.data[i]={...this.data[i], number, debtor, inn, court, note,
            status, updatedAt: now};
        }else{
          this.data.unshift({
            id: crypto.randomUUID(),
            number, debtor, inn, court, note, status,
            createdAt: now, updatedAt: now
          });
        }

        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.cancelEdit();
        this.render();
        this.toggleForm(false);
      },

      remove(id){
        if(!confirm('–£–¥–∞–ª–∏—Ç—å –¥–µ–ª–æ?')) return;
        this.data = this.data.filter(x=>x.id!==id);
        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.render();
      },

      archive(id, toArchive){
        const item=this.data.find(x=>x.id===id); if(!item) return;
        item.status = toArchive ? 'archived' : 'active';
        item.updatedAt = Date.now();
        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.render();
      },

      setQuery(q){ this.state.query=String(q||''); this.render(); },
      setFilter(f, el){
        this.state.filter=f;
        document.querySelectorAll('.cases-filters .chip').forEach(b=>b.classList.remove('active'));
        el?.classList.add('active');
        this.render();
      },

      render(){
        const list=document.getElementById('cases-list');
        const empty=document.getElementById('cases-empty');
        const q=(this.state.query||'').toLowerCase().trim();

        let items=[...this.data];
        if(q){
          items = items.filter(i=>
            (i.number||'').toLowerCase().includes(q) ||
            (i.debtor||'').toLowerCase().includes(q) ||
            (i.court||'').toLowerCase().includes(q) ||
            (i.note||'').toLowerCase().includes(q) ||
            (i.inn||'').includes(q)
          );
        }

        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞—Ä—Ö–∏–≤ —Å–∫—Ä—ã—Ç
        if (this.state.filter === 'archived') {
          items = items.filter(i => i.status === 'archived');
        } else {
          items = items.filter(i => i.status !== 'archived'); // 'all' –∏ 'active'
        }

        items.sort((a,b)=> (a.status==='archived')-(b.status==='archived') || (b.updatedAt||0)-(a.updatedAt||0));

        if(!items.length){
          list.innerHTML='';
          empty.style.display='block';
          window.adjustBottomSpacer && window.adjustBottomSpacer();
          return;
        }
        empty.style.display='none';

        list.innerHTML=items.map(i=>`
          <article class="case-card" role="listitem" data-id="${i.id}">
            <div class="case-head">
              <div class="case-number">${i.number}</div>
              <div class="badge ${i.status==='active'?'active':''}">${i.status==='active'?'–ê–∫—Ç–∏–≤–Ω–æ–µ':'–ê—Ä—Ö–∏–≤'}</div>
            </div>
            <div class="case-row">
              ${i.debtor?`<span><strong>–î–æ–ª–∂–Ω–∏–∫:</strong> ${i.debtor}</span>`:''}
              ${i.inn?`<span><strong>–ò–ù–ù:</strong> ${i.inn}</span>`:''}
              ${i.court?`<span><strong>–°—É–¥:</strong> ${i.court}</span>`:''}
            </div>
            <div class="case-actions">
              <button class="ghost" onclick="CASES && CASES.edit('${i.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              ${i.status==='active'
                ? `<button class="ghost" onclick="CASES && CASES.archive('${i.id}', true)">–í –∞—Ä—Ö–∏–≤</button>`
                : `<button class="ghost" onclick="CASES && CASES.archive('${i.id}', false)">–í–µ—Ä–Ω—É—Ç—å</button>`}
              <button class="ghost" onclick="CASES && CASES.remove('${i.id}')">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </article>
        `).join('');

        window.adjustBottomSpacer && window.adjustBottomSpacer();
      }
    };

    window.CASES.init();
  })();
  </script>
</section>
