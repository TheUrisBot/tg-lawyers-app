<section class="page hearings" id="hearings-page" aria-labelledby="hearings-title">
  <h1 id="hearings-title">–ó–∞—Å–µ–¥–∞–Ω–∏—è</h1>

  <!-- –ü–æ–∏—Å–∫ –∏ –î–æ–±–∞–≤–∏—Ç—å -->
  <div class="hearings-toolbar" role="region" aria-label="–ü–æ–∏—Å–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è">
    <div class="hearings-search">
      <input id="hearings-search-input" type="search" placeholder="–ù–æ–º–µ—Ä –¥–µ–ª–∞, –¥–æ–ª–∂–Ω–∏–∫, —Å—É–¥, –∑–∞–ª, –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ"
             aria-label="–ü–æ–∏—Å–∫" oninput="HEARINGS && HEARINGS.setQuery(this.value)" />
      <button class="ghost" aria-label="–û—á–∏—Å—Ç–∏—Ç—å"
              onclick="HEARINGS && HEARINGS.setQuery(''); const i=document.getElementById('hearings-search-input'); i.value=''; i.focus();">‚úï</button>
    </div>
    <button class="primary" id="hearings-add-btn" aria-expanded="false" onclick="HEARINGS && HEARINGS.toggleForm()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="hearings-filters" role="tablist" aria-label="–§–∏–ª—å—Ç—Ä—ã">
    <button class="chip active" role="tab" aria-selected="true" onclick="HEARINGS && HEARINGS.setFilter('all', this)">–í—Å–µ</button>
    <button class="chip" role="tab" aria-selected="false" onclick="HEARINGS && HEARINGS.setFilter('upcoming', this)">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</button>
    <button class="chip" role="tab" aria-selected="false" onclick="HEARINGS && HEARINGS.setFilter('past', this)">–ü—Ä–æ—à–µ–¥—à–∏–µ</button>
    <button class="chip" role="tab" aria-selected="false" onclick="HEARINGS && HEARINGS.setFilter('archived', this)">–ê—Ä—Ö–∏–≤</button>
  </div>

  <!-- –§–æ—Ä–º–∞ -->
  <div id="hearings-form-wrap" class="collapse" aria-hidden="true">
    <form id="hearings-form" class="hearings-form" onsubmit="HEARINGS && HEARINGS.submit(event)">
      <div class="grid">
        <label>
          <span>–î–µ–ª–æ (–Ω–æ–º–µ—Ä –∏–ª–∏ –¥–æ–ª–∂–Ω–∏–∫)</span>
          <input type="text" id="h-combo" placeholder="–ê40-12345/2025 ‚Äî –û–û–û ¬´–†–æ–º–∞—à–∫–∞¬ª" autocomplete="off" />
          <div id="h-combo-suggest" class="suggest" role="listbox" hidden></div>
        </label>

        <input type="hidden" id="h-case" />
        <input type="hidden" id="h-debtor" />

        <label>
          <span>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</span>
          <input type="datetime-local" id="h-datetime" />
        </label>

        <label>
          <span>–°—É–¥</span>
          <input type="text" id="h-court" placeholder="–ê–° –≥. –ú–æ—Å–∫–≤—ã" />
        </label>

        <label>
          <span>–ó–∞–ª</span>
          <input type="text" id="h-place" placeholder="–ö–∞–±. 305 / –ó–∞–ª ‚Ññ4" />
        </label>

        <label style="grid-column: 1 / -1;">
          <span>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span>
          <textarea id="h-note" rows="2" placeholder="–õ—é–±—ã–µ –¥–µ—Ç–∞–ª–∏ –ø–æ –∑–∞—Å–µ–¥–∞–Ω–∏—é‚Ä¶"></textarea>
        </label>

        <label>
          <span>–°—Ç–∞—Ç—É—Å</span>
          <select id="h-status">
            <option value="active" selected>–ê–∫—Ç–∏–≤–Ω–æ–µ</option>
            <option value="archived">–ê—Ä—Ö–∏–≤</option>
          </select>
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="ghost" onclick="HEARINGS && HEARINGS.toggleForm(false)">–°–≤–µ—Ä–Ω—É—Ç—å</button>
        <button type="submit" id="hearings-submit-btn" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>

  <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <div class="cal" role="region" aria-label="–ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Å—è—Ü–∞">
    <div class="cal-head">
      <div class="cal-title" id="hearings-cal-title">–ê–≤–≥—É—Å—Ç 2025 –≥.</div>
      <div class="cal-actions">
        <button class="ghost navbtn" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü" onclick="HEARINGS && HEARINGS.shiftMonth(-1)">‚Äπ</button>
        <button class="ghost navbtn" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü" onclick="HEARINGS && HEARINGS.shiftMonth(1)">‚Ä∫</button>
        <button class="ghost" onclick="HEARINGS && HEARINGS.today()">–°–µ–≥–æ–¥–Ω—è</button>
        <button class="ghost small" onclick="HEARINGS && HEARINGS.shiftMonth(1)">+1–º</button>
        <button class="ghost small" onclick="HEARINGS && HEARINGS.shiftMonth(3)">+3–º</button>
        <button class="ghost small" onclick="HEARINGS && HEARINGS.shiftMonth(6)">+6–º</button>
      </div>
    </div>

    <div class="cal-grid" id="hearings-cal-grid" role="grid" aria-label="–°–µ—Ç–∫–∞ –¥–Ω–µ–π"></div>

    <div class="cal-foot">
      <button class="ghost" onclick="HEARINGS && HEARINGS.resetCalendar()">–°–±—Ä–æ—Å–∏—Ç—å</button>
      <span class="chip" id="hearings-day-chip" hidden></span>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ -->
  <div id="hearings-list" class="hearings-list" role="list" aria-label="–°–ø–∏—Å–æ–∫ –∑–∞—Å–µ–¥–∞–Ω–∏–π"></div>

  <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
  <div id="hearings-empty" class="empty" hidden>
    <div class="icon">üìÖ</div>
    <div class="title">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—Å–µ–¥–∞–Ω–∏–π</div>
    <div class="hint">–î–æ–±–∞–≤—å—Ç–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ ‚Äî –ø—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –¥–µ–ª—É, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É/–≤—Ä–µ–º—è‚Ä¶</div>
    <button class="primary" onclick="HEARINGS && HEARINGS.toggleForm(true)">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <style>
    .hearings-toolbar{ display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .hearings-search{ display:grid; grid-template-columns:1fr auto; gap:6px; }
    .hearings-search input{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--separator);
      background:var(--tg-theme-secondary-bg-color); color:var(--tg-theme-text-color); outline:none; }
    .hearings-search input:focus{ border-color:var(--app-accent); }

    .hearings-filters{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
    .chip{ border:1px solid var(--separator); background:transparent; color:var(--tg-theme-text-color);
      padding:6px 10px; border-radius:999px; cursor:pointer; }
    .chip.active{ border-color:var(--app-accent); color:var(--app-accent); font-weight:600; }

    .collapse{ max-height:0; overflow:hidden; opacity:0; transition:max-height 240ms ease, opacity 240ms ease; }
    .collapse.open{ opacity:1; }

    .hearings-form{ border:1px solid var(--separator); background:var(--tg-theme-secondary-bg-color);
      border-radius:16px; padding:12px; display:grid; gap:12px; margin-top:8px; }
    .hearings-form .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .hearings-form label{ display:grid; gap:6px; font-size:12px; color:var(--tg-theme-hint-color); }
    .hearings-form input,.hearings-form select,.hearings-form textarea{
      padding:10px 12px; border-radius:12px; border:1px solid var(--separator);
      background:var(--tg-theme-bg-color); color:var(--tg-theme-text-color); outline:none; resize:vertical;
    }
    .hearings-form input:focus,.hearings-form select:focus,.hearings-form textarea:focus{ border-color:var(--app-accent); }
    .form-actions{ display:flex; gap:8px; justify-content:flex-end; }

    .primary,.ghost{ appearance:none; border:1px solid transparent; padding:10px 12px; border-radius:12px; cursor:pointer;
      background:var(--tg-theme-button-color); color:var(--tg-theme-button-text-color); }
    .ghost{ background:transparent; border-color:var(--separator); color:var(--tg-theme-text-color); }

    .cal{ border:1px solid var(--separator); border-radius:16px; background:var(--tg-theme-secondary-bg-color); padding:12px; margin-top:10px; }
    .cal-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cal-title{ font-weight:700; }
    .cal-actions{ display:flex; gap:6px; flex-wrap:wrap; align-items:center; }
    .navbtn{ width:36px; height:36px; display:flex; align-items:center; justify-content:center; }

    .cal-grid{ display:grid; grid-template-columns:repeat(7, 1fr); gap:8px; margin-top:10px; }
    .day{ border:1px solid var(--separator); border-radius:12px; padding:8px; min-height:72px; background:var(--tg-theme-bg-color);
      display:grid; align-content:flex-start; gap:6px; }
    .day header{ display:flex; justify-content:space-between; align-items:center; color:var(--tg-theme-hint-color); font-size:12px; }
    .day .count{ border:1px solid var(--separator); border-radius:999px; padding:2px 6px; font-size:12px; }
    .day.selected{ outline:2px dashed var(--app-accent); outline-offset:2px; }

    .cal-foot{ display:flex; gap:8px; align-items:center; margin-top:8px; }

    .suggest{ position:relative; background:var(--tg-theme-bg-color);
      border:1px solid var(--separator); border-radius:12px; margin-top:6px; max-height:220px; overflow:auto;
      box-shadow:0 6px 24px rgba(0,0,0,.25); }
    .suggest-item{ padding:10px 12px; cursor:pointer; display:flex; justify-content:space-between; gap:12px; }
    .suggest-item:hover, .suggest-item[aria-selected="true"]{ background:var(--tg-theme-secondary-bg-color); }
    .suggest-item .hint{ color:var(--tg-theme-hint-color); font-size:12px; }

    .hearings-list{ display:grid; gap:8px; margin-top:10px; }
    .hearing-card{ border:1px solid var(--separator); background:var(--tg-theme-secondary-bg-color);
      border-radius:16px; padding:12px; display:grid; gap:6px; }
    .hearing-head{ display:flex; justify-content:space-between; align-items:baseline; gap:8px; }
    .hearing-title{ font-weight:700; }
    .badge{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--separator); color:var(--tg-theme-hint-color); }
    .badge.active{ color:var(--app-accent); border-color:var(--app-accent); }
    .hearing-row{ display:flex; gap:10px; flex-wrap:wrap; color:var(--tg-theme-hint-color); font-size:14px; }
    .hearing-actions{ display:flex; gap:8px; margin-top:6px; }
    .hearing-actions .ghost{ border:1px solid var(--separator); background:transparent; border-radius:12px; padding:8px 10px; }

    .empty{ text-align:center; padding:20px 8px; color:var(--tg-theme-hint-color); }
    .empty .icon{ font-size:36px; margin-bottom:8px; }
    .empty .title{ font-weight:700; color:var(--tg-theme-text-color); }

    @media (max-width: 520px){ .hearings-form .grid{ grid-template-columns:1fr; } }
  </style>

  <script type="text/plain" id="hearings-inline-js">
  (function(){
    function setExpanded(btn, wrap, open){ btn?.setAttribute('aria-expanded', String(open)); wrap?.setAttribute('aria-hidden', String(!open)); }
    function fmtDateISO(d){ return d.toISOString().slice(0,10); }
    function monthStart(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
    function monthEnd(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0); }

    // html escaping helpers (quotes-safe)
    function escAttr(s){
      s = (s===undefined || s===null) ? '' : String(s);
      return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
    function escText(s){
      s = (s===undefined || s===null) ? '' : String(s);
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    window.HEARINGS = {
      LS_KEY: 'tl_hearings_v1',
      CASES_KEY: 'tl_cases_v1',
      data: [],
      state: { query:'', filter:'all', month:new Date(), selectedDay:null },
      editingId: null,
      casesIndex: [],

      init(){
        try{ this.data = JSON.parse(localStorage.getItem(this.LS_KEY)||'[]')||[]; }catch(e){ this.data=[]; }
        this.refreshCasesIndex();

        const wrap=document.getElementById('hearings-form-wrap');
        const btn=document.getElementById('hearings-add-btn');
        setExpanded(btn, wrap, false);

        this.initComboSuggest();
        this.renderCalendar();
        this.render();
        this.autoArchiveOld();
      },

      refreshCasesIndex(){
        try{
          const list = JSON.parse(localStorage.getItem(this.CASES_KEY)||'[]')||[];
          const map=new Map();
          list.forEach(c=>{
            const key=(c.number||'').trim();
            if(!key) return;
            if(!map.has(key)) map.set(key,{ number:key, debtor:c.debtor||'', court:c.court||'' });
            const cur=map.get(key);
            if(!cur.debtor && c.debtor) cur.debtor=c.debtor;
            if(!cur.court && c.court) cur.court=c.court;
          });
          this.casesIndex = Array.from(map.values());
        }catch(_){ this.casesIndex=[]; }
      },

      // –ö–æ–º–±–æ-–ø–æ–¥—Å–∫–∞–∑–∫–∏
      initComboSuggest(){
        const input = document.getElementById('h-combo');
        const box   = document.getElementById('h-combo-suggest');
        const openWith = (q)=>{ this.refreshCasesIndex(); this.buildComboSuggestions(box, q); };
        input.addEventListener('click', ()=>openWith(input.value));
        input.addEventListener('input', ()=>openWith(input.value));
        input.addEventListener('blur', ()=>setTimeout(()=>{ box.hidden=true; },120));

        box.addEventListener('mousedown', (e)=>{
          const item = e.target.closest('.suggest-item'); if(!item) return;
          const number = item.getAttribute('data-number')||'';
          const debtor = item.getAttribute('data-debtor')||'';
          const court  = item.getAttribute('data-court')||'';
          document.getElementById('h-case').value = number;
          document.getElementById('h-debtor').value = debtor;
          input.value = number + (debtor ? ' ‚Äî ' + debtor : '');
          const c = document.getElementById('h-court'); if(c && !c.value && court) c.value=court;
          box.hidden = true;
        });
      },
      buildComboSuggestions($box, query){
        const list=this.casesIndex||[]; const q=(query||'').toLowerCase().trim();
        let items=!q?list.slice(0,7):list.filter(c=> c.number.toLowerCase().includes(q) || (c.debtor||'').toLowerCase().includes(q) ).slice(0,7);
        if(!items.length){ $box.hidden=true; $box.innerHTML=''; return; }
        $box.innerHTML = items.map(c=>`
          <div class="suggest-item" role="option"
               data-number="${escAttr(c.number)}" data-debtor="${escAttr(c.debtor||'')}" data-court="${escAttr(c.court||'')}">
            <span><strong>${c.number}</strong></span>
            <span class="hint">${escText(c.debtor||'')}</span>
          </div>`).join('');
        $box.hidden=false;
      },

      // –õ–æ–≥–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –¥–∞—Ç—ã –∑–∞—Å–µ–¥–∞–Ω–∏—è, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª–æ—Å—å)
      autoArchiveOld(){
        const now=Date.now(); let changed=false;
        this.data.forEach(h=>{
          if(h.status==='archived') return;
          const dt=(h.date?new Date(h.date):null);
          if(!dt) return;
          const deadline = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate()+3).getTime();
          if(now>deadline && (!h.updatedAt || h.updatedAt<deadline)){ h.status='archived'; h.updatedAt=now; changed=true; }
        });
        if(changed) localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
      },

      // CRUD
      edit(id){
        const i=this.data.find(x=>x.id===id); if(!i) return;
        this.editingId=id;
        document.getElementById('h-case').value   = i.caseNumber||'';
        document.getElementById('h-debtor').value = i.debtor||'';
        document.getElementById('h-combo').value  = (i.caseNumber||'') + (i.debtor?(' ‚Äî '+i.debtor):'');

        const dtEl=document.getElementById('h-datetime');
        if (dtEl) dtEl.value = (i.date?i.date:'') + 'T' + ((i.time||'').slice(0,5) || '00:00');

        document.getElementById('h-court').value  = i.court||'';
        document.getElementById('h-place').value  = i.place||'';
        document.getElementById('h-note').value   = i.note||'';
        document.getElementById('h-status').value = i.status||'active';
        document.getElementById('hearings-submit-btn').textContent='–û–±–Ω–æ–≤–∏—Ç—å';
        this.toggleForm(true);
      },
      cancelEdit(){
        this.editingId=null;
        document.getElementById('hearings-submit-btn').textContent='–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
        ['h-combo','h-case','h-debtor','h-datetime','h-court','h-place','h-note'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
        document.getElementById('h-status').value='active';
      },
      submit(ev){
        ev.preventDefault();
        const number=document.getElementById('h-case').value.trim();
        const debtor=document.getElementById('h-debtor').value.trim();
        const dt=document.getElementById('h-datetime').value;
        const court=document.getElementById('h-court').value.trim();
        const place=document.getElementById('h-place').value.trim();
        const note=document.getElementById('h-note').value.trim();
        const status=document.getElementById('h-status').value;

        let date='', time='';
        if(dt){ const [d,t] = dt.split('T'); date=d||''; time=t||''; }

        if(!number && !debtor){ alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ª–æ'); return; }

        const now=Date.now();
        if(this.editingId){
          const i=this.data.findIndex(x=>x.id===this.editingId);
          if(i!==-1) this.data[i]={...this.data[i], caseNumber:number, debtor, date, time, court, place, note, status, updatedAt: now};
        }else{
          this.data.unshift({ id: crypto.randomUUID(), caseNumber:number, debtor, date, time, court, place, note, status, createdAt: now, updatedAt: now });
        }

        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.cancelEdit();
        this.render();
        this.toggleForm(false);
      },

      // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
      shiftMonth(delta){ const d=this.state.month; this.state.month = new Date(d.getFullYear(), d.getMonth()+delta, 1); this.renderCalendar(); },
      today(){ this.state.month=new Date(); this.state.selectedDay=fmtDateISO(new Date()); this.renderCalendar(); this.render(); },
      resetCalendar(){ this.state.selectedDay=null; this.renderCalendar(); this.render(); },

      // –§–∏–ª—å—Ç—Ä—ã/–ø–æ–∏—Å–∫
      setQuery(q){ this.state.query=String(q||''); this.render(); },
      setFilter(f, el){
        this.state.filter=f;
        document.querySelectorAll('.hearings-filters .chip').forEach(b=>b.classList.remove('active'));
        el?.classList.add('active');
        this.render();
      },

      renderCalendar(){
        const month=this.state.month;
        const title=document.getElementById('hearings-cal-title');
        const grid=document.getElementById('hearings-cal-grid');
        const locale='ru-RU';
        title.textContent = month.toLocaleDateString(locale, {month:'long', year:'numeric'}).replace(/^./, c=>c.toUpperCase());

        const start=monthStart(month), end=monthEnd(month);
        const firstDow=new Date(start.getFullYear(), start.getMonth(), 1).getDay()||7;
        const days=[];
        for(let i=1;i<firstDow;i++) days.push(null);
        for(let d=1; d<=end.getDate(); d++) days.push(new Date(month.getFullYear(), month.getMonth(), d));

        grid.innerHTML='';
        days.forEach(day=>{
          const cell=document.createElement('div'); cell.className='day';
          if(!day){ cell.style.visibility='hidden'; grid.appendChild(cell); return; }
          const iso=fmtDateISO(day);
          const count=this.data.filter(h=>h.date===iso && h.status!=='archived').length;

          cell.innerHTML = `
            <header><span>${day.getDate()}</span>${count?`<span class="count">${count}</span>`:''}</header>
          `;
          if(this.state.selectedDay && this.state.selectedDay===iso) cell.classList.add('selected');
          cell.addEventListener('click', ()=>{ this.state.selectedDay=iso; this.renderCalendar(); this.render(); });
          grid.appendChild(cell);
        });
      },

      render(){
        const list=document.getElementById('hearings-list');
        const empty=document.getElementById('hearings-empty');
        const q=(this.state.query||'').toLowerCase().trim();

        let items=[...this.data];

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        if(this.state.filter==='archived') items=items.filter(i=>i.status==='archived');
        else if(this.state.filter==='past') items=items.filter(i=> i.status!=='archived' && i.date && new Date(i.date) < new Date());
        else if(this.state.filter==='upcoming') items=items.filter(i=> i.status!=='archived' && i.date && new Date(i.date) >= new Date());
        else items=items.filter(i=>i.status!=='archived');

        // –ü–æ–∏—Å–∫
        if(q){
          items = items.filter(i=>
            (i.caseNumber||'').toLowerCase().includes(q) ||
            (i.debtor||'').toLowerCase().includes(q) ||
            (i.court||'').toLowerCase().includes(q) ||
            (i.place||'').toLowerCase().includes(q) ||
            (i.note||'').toLowerCase().includes(q)
          );
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –¥–Ω—é
        if(this.state.selectedDay){
          items = items.filter(i=> i.date===this.state.selectedDay);
        }

        items.sort((a,b)=> (a.status==='archived')-(b.status==='archived') || (b.updatedAt||0)-(a.updatedAt||0));

        if(!items.length){ list.innerHTML=''; empty.hidden=false; window.adjustBottomSpacer && window.adjustBottomSpacer(); return; }
        empty.hidden=true;

        list.innerHTML=items.map(i=>`
          <article class="hearing-card" role="listitem" data-id="${i.id}">
            <div class="hearing-head">
              <div class="hearing-title">${i.caseNumber || '(–±–µ–∑ –Ω–æ–º–µ—Ä–∞)'}</div>
              <div class="badge ${i.status==='active'?'active':''}">${i.status==='active'?'–ê–∫—Ç–∏–≤–Ω–æ–µ':'–ê—Ä—Ö–∏–≤'}</div>
            </div>
            <div class="hearing-row">
              ${i.debtor?`<span><strong>–î–æ–ª–∂–Ω–∏–∫:</strong> ${i.debtor}</span>`:''}
              ${i.date?`<span><strong>–î–∞—Ç–∞:</strong> ${i.date}</span>`:''}
              ${i.time?`<span><strong>–í—Ä–µ–º—è:</strong> ${i.time.slice(0,5)}</span>`:''}
              ${i.court?`<span><strong>–°—É–¥:</strong> ${i.court}</span>`:''}
              ${i.place?`<span><strong>–ó–∞–ª:</strong> ${i.place}</span>`:''}
              ${i.note?`<span><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> ${i.note}</span>`:''}
            </div>
            <div class="hearing-actions">
              <button class="ghost" onclick="HEARINGS && HEARINGS.edit('${i.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              ${i.status==='active'
                ? `<button class="ghost" onclick="HEARINGS && HEARINGS.archive('${i.id}', true)">–í –∞—Ä—Ö–∏–≤</button>`
                : `<button class="ghost" onclick="HEARINGS && HEARINGS.archive('${i.id}', false)">–í–µ—Ä–Ω—É—Ç—å</button>`}
              <button class="ghost" onclick="HEARINGS && HEARINGS.remove('${i.id}')">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </article>
        `).join('');

        // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–∏–ø–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        const chip=document.getElementById('hearings-day-chip'); if (chip) chip.hidden = !this.state.selectedDay;

        window.adjustBottomSpacer && window.adjustBottomSpacer();
      },

      archive(id, toArchive){
        const i=this.data.findIndex(x=>x.id===id); if(i===-1) return;
        this.data[i].status = toArchive ? 'archived' : 'active';
        this.data[i].updatedAt = Date.now();
        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.render();
      },

      toggleForm(force){
        const wrap=document.getElementById('hearings-form-wrap');
        const btn=document.getElementById('hearings-add-btn');
        const isOpen=wrap.classList.contains('open'); const shouldOpen=(typeof force==='boolean')?force:!isOpen;
        if(shouldOpen===isOpen) return;

        wrap.style.overflow='hidden';
        if(shouldOpen){
          wrap.classList.add('open'); wrap.style.maxHeight=wrap.scrollHeight+'px'; setExpanded(btn,wrap,true);
          document.getElementById('h-combo').focus();
        } else {
          wrap.style.maxHeight=wrap.scrollHeight+'px'; requestAnimationFrame(()=>{ wrap.style.maxHeight='0px'; });
          setExpanded(btn,wrap,false);
          wrap.addEventListener('transitionend',()=>{ wrap.classList.remove('open'); HEARINGS.cancelEdit(); },{once:true});
        }
      },

      remove(id){
        if(!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞—Å–µ–¥–∞–Ω–∏–µ?')) return;
        this.data=this.data.filter(x=>x.id!==id);
        localStorage.setItem(this.LS_KEY, JSON.stringify(this.data));
        this.render();
      }
    };

    window.HEARINGS.init();
  })();
  </script>

  </section>
